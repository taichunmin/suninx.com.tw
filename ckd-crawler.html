<!doctype html><html><head><meta charset="UTF-8"><meta content="IE=edge" http-equiv="X-UA-Compatible"><meta content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,viewport-fit=cover,user-scalable=no" name="viewport"><title>CKD 爬蟲</title><link href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" rel="stylesheet"><link href="https://cdn.jsdelivr.net/npm/font-awesome@4/css/font-awesome.min.css" rel="stylesheet"><link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet"><meta content="日本 CKD 在台中的代理商，代理 CKD 的空壓元件，為產業提供廣泛需求的自動化系統。" name="description"><meta content="日本 CKD 在台中的代理商，代理 CKD 的空壓元件，為產業提供廣泛需求的自動化系統。" property="og:description"><meta content="CKD 爬蟲" property="og:title"><meta content="website" property="og:type"><style>.h1,.h2,.h3,.h4,.h5,.h6,body,h1,h2,h3,h4,h5,h6{font-family:'Noto Sans TC',sans-serif}body{padding-top:60px}</style><style>[v-cloak]{display:none}.h1,.h2,.h3,.h4,.h5,.h6,body,h1,h2,h3,h4,h5,h6{font-family:'Noto Sans TC',sans-serif}</style></head><body><nav class="bg-dark fixed-top navbar navbar-dark navbar-expand-lg"><div class="container"><a class="navbar-brand" href="https://suninx.taichunmin.idv.tw/">山穎氣動</a><button class="navbar-toggler" type="button" aria-controls="navbarSuninx" aria-expanded="false" data-target="#navbarSuninx" data-toggle="collapse"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarSuninx"><div class="mr-auto navbar-nav"><a class="nav-link" href="https://suninx.taichunmin.idv.tw/"><i class="fa fa-fw fa-home"></i> 關於我們</a><a class="nav-link" href="https://suninx.taichunmin.idv.tw/products.html"><i class="fa fa-fw fa-cube"></i> 產品資訊</a></div></div></div></nav><div class="my-3 container-fluid" id="app" v-cloak><h2 class="text-center mb-3">CKD 爬蟲</h2><div class="text-monospace"><textarea class="form-control form-control-sm" rows="15" spellcheck="false" v-model="output"></textarea></div><div class="d-flex mt-3 mx-n2"><button class="btn btn-info mx-2 my-1 text-nowrap" type="button" @click="btnFetchTags">抓取產品分類</button><div class="mx-2 my-1 input-group"><input class="form-control" placeholder="cid" style="max-width:100px" v-model="fetchItemsCid"><div class="input-group-append"><button class="btn btn-info" type="button" @click="btnFetchItemsByCid">抓取分類下的產品</button></div></div></div></div><hr class="mt-5"><div class="my-3 text-center text-muted">Copyright © 山穎氣動科技有限公司 All rights reserved.</div><script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lodash@4/lodash.min.js"></script><script src="https://cdn.jsdelivr.net/npm/papaparse@5/papaparse.min.js"></script><script src="https://cdn.jsdelivr.net/npm/popper.js@1/dist/umd/popper.min.js"></script><script src="https://cdn.jsdelivr.net/npm/qs@6/dist/qs.min.js"></script><script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script><script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.min.js"></script><script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js"></script><script>window.sleep=(t=>new Promise(e=>{setTimeout(e,t)})),window.vm=new Vue({el:"#app",data:{fetchItemsCid:"",output:""},methods:{tsvUnparse:t=>Papa.unparse(t,{headers:!0,delimiter:"\t"}),async fetchTags(){const t=(e,i=1)=>_.flatten(_.map(e,e=>[{depth:i,id:e.tag_id,img:`https://www.ckd.co.jp/kiki/src/tags/${e.tag_img}`,name:e.tag_name,url:`https://www.ckd.co.jp/kiki/sc/product/list?cid=${e.tag_id}&sid=0`},..._.isArray(e.childs)?t(e.childs,i+1):[]])),e=_.get(await axios.get("https://us-central1-taichunmin.cloudfunctions.net/cors-anywhere",{params:{u:"https://www.ckd.co.jp/kiki/sc/product/data/category"}}),"data.list");return _.sortBy(t(e),["depth","id"])},async btnFetchTags(){try{this.showLoading("請稍候","抓取資料中");const t=await this.fetchTags();this.output=this.tsvUnparse(t),await Swal.fire({icon:"success",title:"抓取成功",text:`總共抓到 ${t.length} 筆資料`})}catch(t){console.error(t),await Swal.fire({icon:"error",title:"抓取失敗",text:t.message})}},async fetchItemsByCidPage(t,e=1){const i={},a=document.createElement("div"),s=(t,e,i="innerText")=>_.trim(_.get(t.querySelector(e),i));return a.innerHTML=_.get(await axios.get("https://us-central1-taichunmin.cloudfunctions.net/cors-anywhere",{params:{u:`https://www.ckd.co.jp/kiki/sc/product/list?sid=0&cid=${t}&p=${e}`}}),"data"),i.items=_.chain(a.querySelectorAll("section.item")).map(e=>({id:_.get(s(e,"a.detail","href").match(/detail\/(\d+)/),"1"),img:s(e,".summary img","src"),model:s(e,"dd.font24"),name:s(e,"h1"),note:s(e,".supp"),summary:s(e,".summary p"),tagId:t,tagName:s(e,"p.green01")})).value(),i.next=_.get(s(a,"li.next>a","href").match(/p=(\d+)/),"1"),i},async btnFetchItemsByCid(){try{this.showLoading("請稍候","抓取資料中");const t=[],e=this.fetchItemsCid;let i;do{i&&await window.sleep(100),i=await this.fetchItemsByCidPage(e,_.get(i,"next","1")),t.push(...i.items),this.showLoading("請稍候",`已抓取 ${t.length} 筆資料`)}while(i.next);this.output=this.tsvUnparse(t),await Swal.fire({icon:"success",title:"抓取成功",text:`總共抓到 ${t.length} 筆資料`})}catch(t){console.error(t),await Swal.fire({icon:"error",title:"抓取失敗",text:t.message})}},showLoading(t,e){Swal.fire({title:t,text:e,allowOutsideClick:!1,showConfirmButton:!1,willOpen:()=>{Swal.showLoading()}})}}});</script></body></html>